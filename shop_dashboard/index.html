<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apiwat Shop - ระบบจัดการร้านค้า</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar-scroll { max-height: calc(100vh - 4rem); overflow-y: auto; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .success-popup { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            z-index: 1000; background: white; padding: 2rem; border-radius: 1rem; 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); 
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Success Popup -->
    <div id="successPopup" class="success-popup hidden">
        <div class="text-center">
            <div class="text-green-500 text-6xl mb-4">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">สั่งซื้อสำเร็จ!</h3>
            <p class="text-gray-600 mb-4">คำสั่งซื้อของคุณได้รับการยืนยันแล้ว</p>
            <button onclick="closeSuccessPopup()" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600">
                ตกลง
            </button>
        </div>
    </div>

    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-64 bg-gray-900 text-white sidebar-scroll">
            <div class="p-4 border-b border-gray-700">
                <h1 class="text-xl font-bold">Admin Dashboard</h1>
            </div>
            <nav class="p-4">
                <ul class="space-y-2">
                    <li><a href="#" onclick="showSection('dashboard')" class="flex items-center p-3 rounded hover:bg-gray-700 nav-item active">
                        <i class="fas fa-tachometer-alt mr-3"></i> แดชบอร์ด
                    </a></li>
                    <li><a href="#" onclick="showSection('products')" class="flex items-center p-3 rounded hover:bg-gray-700 nav-item">
                        <i class="fas fa-box mr-3"></i> จัดการสินค้า
                    </a></li>
                    <li><a href="#" onclick="showSection('users')" class="flex items-center p-3 rounded hover:bg-gray-700 nav-item">
                        <i class="fas fa-users mr-3"></i> จัดการผู้ใช้
                    </a></li>
                    <li><a href="#" onclick="showSection('shop')" class="flex items-center p-3 rounded hover:bg-gray-700 nav-item">
                        <i class="fas fa-store mr-3"></i> หน้าร้านค้า
                    </a></li>
                    <li><a href="#" onclick="showSection('orders')" class="flex items-center p-3 rounded hover:bg-gray-700 nav-item">
                        <i class="fas fa-shopping-cart mr-3"></i> คำสั่งซื้อ
                    </a></li>
                </ul>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-auto">
            <!-- Dashboard Section -->
            <div id="dashboard" class="section p-6">
                <h2 class="text-2xl font-bold mb-6">แดชบอร์ด</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-100 rounded-full">
                                <i class="fas fa-box text-blue-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-gray-600">สินค้าทั้งหมด</p>
                                <p class="text-2xl font-bold" id="totalProducts">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center">
                            <div class="p-3 bg-green-100 rounded-full">
                                <i class="fas fa-users text-green-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-gray-600">ผู้ใช้ทั้งหมด</p>
                                <p class="text-2xl font-bold" id="totalUsers">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-full">
                                <i class="fas fa-shopping-cart text-yellow-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-gray-600">คำสั่งซื้อ</p>
                                <p class="text-2xl font-bold" id="totalOrders">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex items-center">
                            <div class="p-3 bg-purple-100 rounded-full">
                                <i class="fas fa-dollar-sign text-purple-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-gray-600">ยอดขาย</p>
                                <p class="text-2xl font-bold" id="totalRevenue">฿0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Section -->
            <div id="products" class="section hidden p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">จัดการสินค้า</h2>
                    <button onclick="showAddProductForm()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-plus mr-2"></i>เพิ่มสินค้า
                    </button>
                </div>

                <!-- Add Product Form -->
                <div id="addProductForm" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
                    <h3 class="text-lg font-bold mb-4">เพิ่มสินค้าใหม่</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="productName" placeholder="ชื่อสินค้า" class="border rounded-lg px-3 py-2">
                        <input type="number" id="productPrice" placeholder="ราคา" class="border rounded-lg px-3 py-2">
                        <input type="number" id="productDiscount" placeholder="ส่วนลด (%)" class="border rounded-lg px-3 py-2" min="0" max="100">
                        <input type="text" id="productCategory" placeholder="หมวดหมู่" class="border rounded-lg px-3 py-2">
                        <input type="url" id="productImage" placeholder="URL รูปภาพ" class="border rounded-lg px-3 py-2 md:col-span-2">
                        <textarea id="productDescription" placeholder="รายละเอียดสินค้า" class="border rounded-lg px-3 py-2 md:col-span-2 h-24"></textarea>
                    </div>
                    <div class="flex gap-2 mt-4">
                        <button onclick="addProduct()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">บันทึก</button>
                        <button onclick="hideAddProductForm()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">ยกเลิก</button>
                    </div>
                </div>

                <!-- Products List -->
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">สินค้า</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ราคา</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ส่วนลด</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">หมวดหมู่</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">จัดการ</th>
                            </tr>
                        </thead>
                        <tbody id="productsTable" class="divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Users Section -->
            <div id="users" class="section hidden p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">จัดการผู้ใช้</h2>
                    <button onclick="showAddUserForm()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-plus mr-2"></i>เพิ่มผู้ใช้
                    </button>
                </div>

                <!-- Add User Form -->
                <div id="addUserForm" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
                    <h3 class="text-lg font-bold mb-4">เพิ่มผู้ใช้ใหม่</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="userName" placeholder="ชื่อผู้ใช้" class="border rounded-lg px-3 py-2">
                        <input type="email" id="userEmail" placeholder="อีเมล" class="border rounded-lg px-3 py-2">
                        <input type="tel" id="userPhone" placeholder="เบอร์โทร" class="border rounded-lg px-3 py-2">
                        <select id="userRole" class="border rounded-lg px-3 py-2">
                            <option value="user">ผู้ใช้ทั่วไป</option>
                            <option value="admin">ผู้ดูแลระบบ</option>
                        </select>
                    </div>
                    <div class="flex gap-2 mt-4">
                        <button onclick="addUser()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">บันทึก</button>
                        <button onclick="hideAddUserForm()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">ยกเลิก</button>
                    </div>
                </div>

                <!-- Users List -->
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ชื่อ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">อีเมล</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">เบอร์โทร</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">บทบาท</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">จัดการ</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable" class="divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Shop Section -->
            <div id="shop" class="section hidden p-6 bg-gray-800 min-h-screen">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white">ร้านค้าออนไลน์</h2>
                    <div class="flex items-center gap-4">
                        <div class="relative">
                            <button onclick="toggleCart()" class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-600 flex items-center">
                                <i class="fas fa-shopping-cart mr-2"></i>
                                ตระกร้า (<span id="cartCount">0</span>)
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Cart Sidebar -->
                <div id="cartSidebar" class="fixed right-0 top-0 h-full w-80 bg-white shadow-lg transform translate-x-full transition-transform z-50">
                    <div class="p-4 border-b">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-bold">ตระกร้าสินค้า</h3>
                            <button onclick="toggleCart()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-4 flex-1 overflow-y-auto" style="height: calc(100vh - 200px);">
                        <div id="cartItems"></div>
                    </div>
                    <div class="p-4 border-t">
                        <div class="flex justify-between items-center mb-4">
                            <span class="font-bold">รวม:</span>
                            <span class="font-bold text-lg" id="cartTotal">฿0</span>
                        </div>
                        <button onclick="checkout()" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">
                            ชำระเงิน
                        </button>
                    </div>
                </div>

                <!-- Products Grid -->
                <div id="shopProducts" class="product-grid">
                </div>
            </div>

            <!-- Orders Section -->
            <div id="orders" class="section hidden p-6">
                <h2 class="text-2xl font-bold mb-6">คำสั่งซื้อ</h2>
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">รหัสคำสั่งซื้อ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">วันที่</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">รายการ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ยอดรวม</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">สถานะ</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTable" class="divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let products = [];
        let users = [];
        let cart = [];
        let orders = [];
        let currentEditingProduct = null;
        let currentEditingUser = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadSampleData();
            updateDashboard();
            renderProducts();
            renderUsers();
            renderShopProducts();
            renderOrders();
        });

        // Load sample data
        function loadSampleData() {
            products = [
                {
                    id: 1,
                    name: 'iPhone 15 Pro',
                    price: 45900,
                    discount: 10,
                    category: 'มือถือ',
                    description: 'iPhone รุ่นล่าสุด พร้อมชิป A17 Pro',
                    image: 'https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=300'
                },
                {
                    id: 2,
                    name: 'MacBook Air M2',
                    price: 42900,
                    discount: 5,
                    category: 'คอมพิวเตอร์',
                    description: 'MacBook Air ชิป M2 13 นิ้ว',
                    image: 'https://images.unsplash.com/photo-1541807084-5c52b6b3adef?w=300'
                },
                {
                    id: 3,
                    name: 'AirPods Pro',
                    price: 8900,
                    discount: 15,
                    category: 'หูฟัง',
                    description: 'หูฟังไร้สาย พร้อม Active Noise Cancellation',
                    image: 'https://images.unsplash.com/photo-1572569511254-d8f925fe2cbb?w=300'
                }
            ];

            users = [
                {
                    id: 1,
                    name: 'สมชาย ใจดี',
                    email: 'somchai@email.com',
                    phone: '081-234-5678',
                    role: 'user'
                },
                {
                    id: 2,
                    name: 'สมหญิง รักดี',
                    email: 'somying@email.com',
                    phone: '082-345-6789',
                    role: 'admin'
                }
            ];
        }

        // Navigation
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active', 'bg-gray-700');
            });
            event.target.closest('.nav-item').classList.add('active', 'bg-gray-700');
        }

        // Dashboard functions
        function updateDashboard() {
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalOrders').textContent = orders.length;
            
            const revenue = orders.reduce((sum, order) => sum + order.total, 0);
            document.getElementById('totalRevenue').textContent = `฿${revenue.toLocaleString()}`;
        }

        // Product management
        function showAddProductForm() {
            document.getElementById('addProductForm').classList.remove('hidden');
            clearProductForm();
        }

        function hideAddProductForm() {
            document.getElementById('addProductForm').classList.add('hidden');
            currentEditingProduct = null;
        }

        function clearProductForm() {
            document.getElementById('productName').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productDiscount').value = '';
            document.getElementById('productCategory').value = '';
            document.getElementById('productImage').value = '';
            document.getElementById('productDescription').value = '';
        }

        function addProduct() {
            const name = document.getElementById('productName').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const discount = parseFloat(document.getElementById('productDiscount').value) || 0;
            const category = document.getElementById('productCategory').value;
            const image = document.getElementById('productImage').value;
            const description = document.getElementById('productDescription').value;

            if (!name || !price || !category) {
                alert('กรุณากรอกข้อมูลให้ครบถ้วน');
                return;
            }

            if (currentEditingProduct) {
                // Edit existing product
                const index = products.findIndex(p => p.id === currentEditingProduct);
                products[index] = {
                    ...products[index],
                    name, price, discount, category, image, description
                };
            } else {
                // Add new product
                const newProduct = {
                    id: Date.now(),
                    name, price, discount, category, image, description
                };
                products.push(newProduct);
            }

            renderProducts();
            renderShopProducts();
            updateDashboard();
            hideAddProductForm();
        }

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (product) {
                currentEditingProduct = id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productDiscount').value = product.discount;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productImage').value = product.image;
                document.getElementById('productDescription').value = product.description;
                showAddProductForm();
            }
        }

        function deleteProduct(id) {
            if (confirm('คุณต้องการลบสินค้านี้หรือไม่?')) {
                products = products.filter(p => p.id !== id);
                renderProducts();
                renderShopProducts();
                updateDashboard();
            }
        }

        function renderProducts() {
            const tbody = document.getElementById('productsTable');
            tbody.innerHTML = '';

            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <img src="${product.image}" alt="${product.name}" class="w-12 h-12 rounded-lg object-cover mr-4" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yNCAzNkMzMC42Mjc0IDM2IDM2IDMwLjYyNzQgMzYgMjRDMzYgMTcuMzcyNiAzMC42Mjc0IDEyIDI0IDEyQzE3LjM3MjYgMTIgMTIgMTcuMzcyNiAxMiAyNEMxMiAzMC42Mjc0IDE3LjM3MjYgMzYgMjQgMzYiIGZpbGw9IiNEMUQ1REIiLz4KPC9zdmc+'">
                            <div>
                                <div class="font-medium">${product.name}</div>
                                <div class="text-sm text-gray-500">${product.description}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">฿${product.price.toLocaleString()}</td>
                    <td class="px-6 py-4">${product.discount}%</td>
                    <td class="px-6 py-4">${product.category}</td>
                    <td class="px-6 py-4">
                        <button onclick="editProduct(${product.id})" class="text-blue-600 hover:text-blue-800 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteProduct(${product.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // User management
        function showAddUserForm() {
            document.getElementById('addUserForm').classList.remove('hidden');
            clearUserForm();
        }

        function hideAddUserForm() {
            document.getElementById('addUserForm').classList.add('hidden');
            currentEditingUser = null;
        }

        function clearUserForm() {
            document.getElementById('userName').value = '';
            document.getElementById('userEmail').value = '';
            document.getElementById('userPhone').value = '';
            document.getElementById('userRole').value = 'user';
        }

        function addUser() {
            const name = document.getElementById('userName').value;
            const email = document.getElementById('userEmail').value;
            const phone = document.getElementById('userPhone').value;
            const role = document.getElementById('userRole').value;

            if (!name || !email || !phone) {
                alert('กรุณากรอกข้อมูลให้ครบถ้วน');
                return;
            }

            if (currentEditingUser) {
                // Edit existing user
                const index = users.findIndex(u => u.id === currentEditingUser);
                users[index] = {
                    ...users[index],
                    name, email, phone, role
                };
            } else {
                // Add new user
                const newUser = {
                    id: Date.now(),
                    name, email, phone, role
                };
                users.push(newUser);
            }

            renderUsers();
            updateDashboard();
            hideAddUserForm();
        }

        function editUser(id) {
            const user = users.find(u => u.id === id);
            if (user) {
                currentEditingUser = id;
                document.getElementById('userName').value = user.name;
                document.getElementById('userEmail').value = user.email;
                document.getElementById('userPhone').value = user.phone;
                document.getElementById('userRole').value = user.role;
                showAddUserForm();
            }
        }

        function deleteUser(id) {
            if (confirm('คุณต้องการลบผู้ใช้นี้หรือไม่?')) {
                users = users.filter(u => u.id !== id);
                renderUsers();
                updateDashboard();
            }
        }

        function renderUsers() {
            const tbody = document.getElementById('usersTable');
            tbody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 font-medium">${user.name}</td>
                    <td class="px-6 py-4">${user.email}</td>
                    <td class="px-6 py-4">${user.phone}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs rounded-full ${user.role === 'admin' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                            ${user.role === 'admin' ? 'ผู้ดูแลระบบ' : 'ผู้ใช้ทั่วไป'}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <button onclick="editUser(${user.id})" class="text-blue-600 hover:text-blue-800 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteUser(${user.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Shop functions
        function renderShopProducts() {
            const container = document.getElementById('shopProducts');
            container.innerHTML = '';

            products.forEach(product => {
                const discountedPrice = product.price * (1 - product.discount / 100);
                const productCard = document.createElement('div');
                productCard.className = 'bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow fade-in';
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDMwMCAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMTkyIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xNTAgMTQ0QzE3MS4yMTEgMTQ0IDE4OCAxMjcuMjExIDE4OCAxMDZDMTg4IDg0Ljc4OSAxNzEuMjExIDY4IDE1MCA2OEMxMjguNzg5IDY4IDExMiA4NC43ODkgMTEyIDEwNkMxMTIgMTI3LjIxMSAxMjguNzg5IDE0NCAxNTAgMTQ0WiIgZmlsbD0iI0QxRDVEQiIvPgo8L3N2Zz4='">
                    <div class="p-4">
                        <h3 class="font-bold text-lg mb-2">${product.name}</h3>
                        <p class="text-gray-600 text-sm mb-3">${product.description}</p>
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                ${product.discount > 0 ? `
                                    <span class="text-red-500 font-bold text-lg">฿${discountedPrice.toLocaleString()}</span>
                                    <span class="text-gray-400 line-through ml-2">฿${product.price.toLocaleString()}</span>
                                    <span class="bg-red-500 text-white text-xs px-2 py-1 rounded ml-2">-${product.discount}%</span>
                                ` : `
                                    <span class="text-gray-800 font-bold text-lg">฿${product.price.toLocaleString()}</span>
                                `}
                            </div>
                        </div>
                        <button onclick="addToCart(${product.id})" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-cart-plus mr-2"></i>หยิบลงตระกร้า
                        </button>
                    </div>
                `;
                container.appendChild(productCard);
            });
        }

        // Cart functions
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const existingItem = cart.find(item => item.id === productId);
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({
                        ...product,
                        quantity: 1
                    });
                }
                updateCartDisplay();
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartDisplay();
        }

        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    updateCartDisplay();
                }
            }
        }

        function updateCartDisplay() {
            const cartCount = document.getElementById('cartCount');
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');

            cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);

            cartItems.innerHTML = '';
            let total = 0;

            cart.forEach(item => {
                const discountedPrice = item.price * (1 - item.discount / 100);
                const itemTotal = discountedPrice * item.quantity;
                total += itemTotal;

                const cartItem = document.createElement('div');
                cartItem.className = 'flex items-center justify-between p-3 border-b';
                cartItem.innerHTML = `
                    <div class="flex-1">
                        <h4 class="font-medium">${item.name}</h4>
                        <p class="text-sm text-gray-600">฿${discountedPrice.toLocaleString()} x ${item.quantity}</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="updateQuantity(${item.id}, -1)" class="bg-gray-200 text-gray-700 w-6 h-6 rounded text-sm">-</button>
                        <span class="w-8 text-center">${item.quantity}</span>
                        <button onclick="updateQuantity(${item.id}, 1)" class="bg-gray-200 text-gray-700 w-6 h-6 rounded text-sm">+</button>
                        <button onclick="removeFromCart(${item.id})" class="text-red-500 ml-2">
                            <i class="fas fa-trash text-sm"></i>
                        </button>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });

            cartTotal.textContent = `฿${total.toLocaleString()}`;
        }

        function toggleCart() {
            const cartSidebar = document.getElementById('cartSidebar');
            cartSidebar.classList.toggle('translate-x-full');
        }

        function checkout() {
            if (cart.length === 0) {
                alert('ตระกร้าสินค้าว่างเปล่า');
                return;
            }

            const total = cart.reduce((sum, item) => {
                const discountedPrice = item.price * (1 - item.discount / 100);
                return sum + (discountedPrice * item.quantity);
            }, 0);

            const order = {
                id: Date.now(),
                date: new Date().toLocaleDateString('th-TH'),
                items: [...cart],
                total: total,
                status: 'ชำระเงินแล้ว'
            };

            orders.push(order);
            cart = [];
            updateCartDisplay();
            toggleCart();
            showSuccessPopup();
            updateDashboard();
            renderOrders();
        }

        function showSuccessPopup() {
            document.getElementById('successPopup').classList.remove('hidden');
        }

        function closeSuccessPopup() {
            document.getElementById('successPopup').classList.add('hidden');
            showSection('orders');
        }

        // Orders functions
        function renderOrders() {
            const tbody = document.getElementById('ordersTable');
            tbody.innerHTML = '';

            orders.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 font-medium">#${order.id}</td>
                    <td class="px-6 py-4">${order.date}</td>
                    <td class="px-6 py-4">
                        <div class="text-sm">
                            ${order.items.map(item => `${item.name} x${item.quantity}`).join(', ')}
                        </div>
                    </td>
                    <td class="px-6 py-4 font-bold">฿${order.total.toLocaleString()}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">
                            ${order.status}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97687bf1b369731c',t:'MTc1NjQzMzEzNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>